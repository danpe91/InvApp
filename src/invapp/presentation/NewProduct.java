package invapp.presentation;

import invapp.business.LogicProduct;
import invapp.dto.DTOProduct;

public class NewProduct extends javax.swing.JFrame {

    private boolean edit;

    static {
        setLookAndFeel();
    }

    public NewProduct(DTOProduct inv) {

        setTitle("Nuevo Producto");
        initComponents();
        setLocationByPlatform(true);

        stockSpinner.setModel(new javax.swing.SpinnerNumberModel(1, 0, Integer.MAX_VALUE, 1));
        productTextField.setText(inv.getProduct());
        unitPriceTextField.setText(String.format("%.2f",inv.getUnitPrice()));
        codeTextField.setText(inv.getCode().toString());
        stockSpinner.setValue(inv.getStock());
        codeTextField.setEditable(false);
        addButton.setText("Guardar");
        
        edit = true;
    }

    public NewProduct() {

        setTitle("Nuevo Producto");
        initComponents();
        setLocationByPlatform(true);
        
        stockSpinner.setModel(new javax.swing.SpinnerNumberModel(1, 0, Integer.MAX_VALUE, 1));
        
        edit = false;
    }

    public void insertProduct() {

        if (checkEmptyFields()) {

            try {

                DTOProduct prod = new DTOProduct(codeTextField.getText().trim(),
                        productTextField.getText().trim(), Double.valueOf(unitPriceTextField.getText().trim()), (int) stockSpinner.getValue());

                new LogicProduct().insertProduct(prod);
                cleanFields();

            } catch (NumberFormatException e) {
                e.printStackTrace();
            }
        } else {
            javax.swing.JOptionPane.showMessageDialog(null, "Error: verifique los datos ingresados! ",
                    "Ha ocurrido un error", javax.swing.JOptionPane.ERROR_MESSAGE);

        }
    }

    public void cleanFields() {

        productTextField.setText("");
        unitPriceTextField.setText("");
        codeTextField.setText("");
        stockSpinner.setValue(1);
    }

    public void editAccesory() {

        try {
            DTOProduct prod = new DTOProduct(codeTextField.getText(),
                    productTextField.getText(), Double.valueOf(unitPriceTextField.getText().trim()), (int)stockSpinner.getValue());
            new LogicProduct().editProduct(prod);
            cleanFields();

        } catch (NumberFormatException e) {
            javax.swing.JOptionPane.showMessageDialog(null, "Error: verifique el precio unitario! ",
                    "Ha ocurrido un error", javax.swing.JOptionPane.ERROR_MESSAGE);
        }
    }

    private boolean checkEmptyFields() {

        return !(productTextField.getText().isEmpty()
                || unitPriceTextField.getText().isEmpty()
                || codeTextField.getText().isEmpty());
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup = new javax.swing.ButtonGroup();
        jLabel1 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        productTextField = new javax.swing.JTextField();
        unitPriceTextField = new javax.swing.JTextField();
        addButton = new javax.swing.JButton();
        salirButton = new javax.swing.JButton();
        codeLabel = new javax.swing.JLabel();
        codeTextField = new javax.swing.JTextField();
        stockSpinner = new javax.swing.JSpinner();
        jLabel2 = new javax.swing.JLabel();
        menuBar = new javax.swing.JMenuBar();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jLabel1.setText("Producto");

        jLabel4.setText("Precio Unitario");

        unitPriceTextField.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

        addButton.setMnemonic('A');
        addButton.setText("Agregar");
        addButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addButtonActionPerformed(evt);
            }
        });

        salirButton.setMnemonic('s');
        salirButton.setText("Salir");
        salirButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                salirButtonActionPerformed(evt);
            }
        });

        codeLabel.setText("Clave");

        jLabel2.setText("Cantidad");
        setJMenuBar(menuBar);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(salirButton, javax.swing.GroupLayout.PREFERRED_SIZE, 121, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 41, Short.MAX_VALUE)
                        .addComponent(addButton, javax.swing.GroupLayout.PREFERRED_SIZE, 145, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(24, 24, 24))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addGap(45, 45, 45)
                        .addComponent(productTextField))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(jLabel2)
                            .addComponent(codeLabel))
                        .addGap(13, 13, 13)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(stockSpinner, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(unitPriceTextField)
                            .addComponent(codeTextField))))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(productTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(28, 28, 28)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4)
                    .addComponent(unitPriceTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(stockSpinner, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(codeTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(codeLabel))
                .addGap(33, 33, 33)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(salirButton, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(addButton, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(51, Short.MAX_VALUE))
        );

        getRootPane().setDefaultButton(addButton);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void addButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addButtonActionPerformed

        if (!edit) {
            insertProduct();
        } else {
            editAccesory();
            dispose();
        }
    }//GEN-LAST:event_addButtonActionPerformed

    private void salirButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_salirButtonActionPerformed

        dispose();
    }//GEN-LAST:event_salirButtonActionPerformed

    private static void setLookAndFeel() {

        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
        }

    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton addButton;
    private javax.swing.ButtonGroup buttonGroup;
    private javax.swing.JLabel codeLabel;
    private javax.swing.JTextField codeTextField;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JMenuBar menuBar;
    private javax.swing.JTextField productTextField;
    private javax.swing.JButton salirButton;
    private javax.swing.JSpinner stockSpinner;
    private javax.swing.JTextField unitPriceTextField;
    // End of variables declaration//GEN-END:variables
}
